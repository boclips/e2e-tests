#!/usr/bin/env bash

produce_output () {
    mkdir -p source/cypress/{screenshots,videos}
    touch source/cypress/{screenshots,videos}/tar-avoid-empty-dir
    cd "source/cypress" || exit
    tar -cf ../../test-results/results.tar \
        screenshots/* \
        videos/*
}
trap produce_output EXIT

(
cd source || exit 1
npm config set cache ~/npm-cache
npm ci || exit 1
npm run cypress:run -- --spec="$SPEC"
)
