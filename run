#!/usr/bin/env bash

set -e

if [ "$1" = "ci" ]
then
    cypress="npm run cypress:run"
else
    cypress="npm run cypress:open"
fi

: ${CYPRESS_TOKEN_URL:="https://login.testing-boclips.com/auth/realms/teachers/protocol/openid-connect/token"}
: ${CYPRESS_VIDEOSERVICE_BASE_URL:="https://video-service.testing-boclips.com"}
: ${CYPRESS_BACKOFFICE_BASE_URL:="https://backoffice.testing-boclips.com"}
: ${CYPRESS_FRONTEND_BASE_URL:="https://publishers.testing-boclips.com"}
: ${CYPRESS_TEACHERS_BASE_URL:="https://teachers.testing-boclips.com"}
: ${CYPRESS_BACKOFFICE_USERNAME:="$(lpass show e2e-backoffice-testing --username)"}
: ${CYPRESS_BACKOFFICE_PASSWORD:="$(lpass show e2e-backoffice-testing --password)"}
: ${CYPRESS_FRONTEND_USERNAME:="$(lpass show e2e-frontend-testing --username)"}
: ${CYPRESS_FRONTEND_PASSWORD:="$(lpass show e2e-frontend-testing --password)"}
: ${CYPRESS_OPERATOR_USERNAME:="$(lpass show operator-testing --username)"}
: ${CYPRESS_OPERATOR_PASSWORD:="$(lpass show operator-testing --password)"}

export CYPRESS_VIDEOSERVICE_BASE_URL
export CYPRESS_TOKEN_URL
export CYPRESS_BACKOFFICE_BASE_URL
export CYPRESS_BACKOFFICE_USERNAME
export CYPRESS_BACKOFFICE_PASSWORD
export CYPRESS_TEACHERS_BASE_URL
export CYPRESS_FRONTEND_BASE_URL
export CYPRESS_FRONTEND_USERNAME
export CYPRESS_FRONTEND_PASSWORD
export CYPRESS_OPERATOR_USERNAME
export CYPRESS_OPERATOR_PASSWORD

node setupE2E.js

$cypress
